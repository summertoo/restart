# Sui 智能合约项目 - 自锁仓系统

## 项目概述

这是一个基于 Sui 区块链的智能合约项目，实现了一个功能完整的自锁仓（Self-Locking Vault）系统。该系统支持多种代币类型、灵活的锁仓规则、授权管理以及丰富的查询功能。

## 核心功能模块

### 1. 核心锁仓模块 (`locked_object::core`)

**主要功能：**
- 创建自锁仓对象
- 存入和提取代币
- 锁仓规则管理
- 所有权转移

**核心特性：**
- 支持任意代币类型（泛型设计）
- 灵活的锁仓规则配置
- 完整的事件记录
- 安全的权限控制

**锁仓规则包括：**
- 最小锁仓时间
- 每日提取限额
- 自动再投资选项
- 紧急提取功能
- 提取手续费率

### 2. 增强锁仓模块 (`locked_object::enhanced`)

**扩展功能：**
- 授权操作员管理
- 细粒度权限控制
- 传统模式与授权模式切换

**权限类型：**
- 存款权限
- 提取权限
- 规则更新权限
- 时间限制和金额限制

### 3. 多币种支持模块 (`locked_object::multi_currency`)

**支持的代币：**
- SUI（原生代币）
- USDC（USD Coin）
- USDT（Tether）

**功能特性：**
- 代币元数据管理
- 精度处理
- 便捷的币种特定函数
- 代币格式化显示

### 4. 授权管理模块 (`locked_object::authorization`)

**核心功能：**
- 操作员授权和撤销
- 权限验证
- 时间限制管理
- 权限查询

**安全特性：**
- 基于时间的权限过期
- 金额限制控制
- 细粒度权限管理

### 5. 工具函数模块 (`locked_object::utils`)

**数学工具：**
- 安全除法
- 百分比计算
- 基点转换
- 数值范围控制

**时间工具：**
- 时间间隔验证
- 时间差计算
- 单位转换

**验证工具：**
- 参数验证
- 权限检查
- 风险管理
- 状态一致性验证

### 6. 类型定义模块 (`locked_object::types`)

**核心类型：**
- 代币类型枚举
- 锁仓规则结构
- 存款记录结构
- 辅助构造函数

## 技术特性

### 安全性
- **权限控制**：严格的所有权和权限验证
- **参数验证**：全面的输入参数检查
- **溢出保护**：安全的数学运算
- **状态一致性**：内置的状态验证机制

### 灵活性
- **泛型设计**：支持任意代币类型
- **可配置规则**：灵活的锁仓参数设置
- **模式切换**：传统模式与授权模式
- **多币种支持**：同时支持多种主流代币

### 可扩展性
- **模块化设计**：清晰的功能分离
- **事件系统**：完整的操作事件记录
- **查询接口**：丰富的状态查询功能
- **工具函数**：可复用的辅助功能

## 使用场景

### 1. 个人理财
- 长期投资锁定
- 定期储蓄计划
- 风险控制投资

### 2. DeFi 应用
- 流动性挖矿
- 收益农场
- 跨链桥接

### 3. 企业资金管理
- 资金冻结
- 分期释放
- 员工激励

### 4. 机器人交易
- 自动化投资
- 策略执行
- 风险管理

## 合约架构

```
locked_object/
├── core/                    # 核心锁仓功能
├── enhanced/               # 增强功能（授权管理）
├── multi_currency/         # 多币种支持
├── authorization/          # 授权管理
├── utils/                 # 工具函数
└── types/                 # 类型定义
```

## 编译状态

✅ **编译成功** - 所有模块已通过 Move 编译器验证

**修复的问题：**
- 语法错误修复（缺失分号）
- 变量可变性问题修复
- 导入语句优化

**当前状态：**
- 无编译错误
- 仅存在轻微警告（不影响功能）
- 所有模块可正常部署

## 示例用法

### 创建基础锁仓
```move
// 创建 SUI 锁仓对象
let locked_object = core::create_locked_object<SUI>(
    name: b"My Vault",
    description: b"Personal savings vault",
    min_lock_period: 86400,  // 1天
    max_withdrawal_per_day: 1000,
    auto_reinvest: false,
    emergency_withdrawal: true,
    withdrawal_fee_rate: 100,  // 1%
    ctx
);
```

### 授权操作员
```move
// 授权操作员
enhanced::authorize_operator(
    &mut locked_object,
    operator: 0x1234...,
    can_deposit: true,
    can_withdraw: false,
    can_update_rules: false,
    max_withdrawal_amount: 500,
    daily_withdrawal_limit: 100,
    expires_at: current_time + 86400 * 30,  // 30天后过期
    ctx
);
```

## 开发状态

- ✅ 核心功能实现完成
- ✅ 多币种支持完成
- ✅ 授权系统完成
- ✅ 工具函数库完成
- ✅ 编译问题修复完成
- 🔄 测试用例开发中
- 🔄 文档完善中

## 技术栈

- **区块链**: Sui
- **语言**: Move
- **开发工具**: Sui CLI
- **测试框架**: Move Unit Test


## 许可证

本项目采用 MIT 许可证。

